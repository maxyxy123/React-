<!doctype html>
<html>
  <head>
    <title>React Basics</title>
  </head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 90vh;
    }
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid white;
      min-height: 40vh;
      min-width: 40vh;
      color: white;
      justify-content: space-around;
    }
  </style>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
      function App() {
        const [input, setInput] = React.useState("");
        const [pokeData, setPokeData] = React.useState(null);


        React.useEffect(() => {
            const controller = new AbortController();

            const timerId=setTimeout(async ()=>{

               const a = input.trim().toLowerCase()

               if(a===''){
                setPokeData(null)
                return;
               }
        
                try{

                    const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${a}`,{
                        signal : controller.signal
                    })
                    if(!response.ok){
                        const err = await response.text()
                        throw new Error(`${response.status},${err}`)
                    }
                    const data = await response.json();

                    if (controller.signal.aborted) return;

                    setPokeData(data);//thg data dag la object;


                }catch(error){

                    if(error.name === 'AbortError'){
                        console.log('Huy co muc dich')
                        return;
                    }
                    setPokeData(null)
                    console.log(error);
                }
            },600)
            
            return()=>{
                clearTimeout(timerId)
                controller.abort('Huy lan trc')
            }
        }, [input]);
        return (
          <>
            <PokeSearch input={input} setInput={setInput} pokeData={pokeData} />
          </>
        );
      }

      function PokeSearch({ input, setInput, pokeData }) {
        function press(e) {
          setInput(e.target.value);
        }
        const imgSrc = pokeData?.sprites?.front_default;
        return (
          <>
            <main>
              <div>PokeMon Api</div>
              <input type="text" value={input} onChange={press} />
              {!pokeData && <div>Please Enter Prober name</div>}
              {pokeData && (
                <>
                  {imgSrc ? (
                    <img
                      src={imgSrc}
                      alt={pokeData?.name || "pokemon"}
                      width="96"
                      height="96"
                    />
                  ) : (
                    <div>No image</div>
                  )}

                  <div>{pokeData?.name ?? "No data"}</div>
                  <div>
                    Base Experience: {pokeData?.base_experience ?? "No data"}
                  </div>
                </>
              )}
            </main>
          </>
        );
      }

      const container = document.querySelector(".js-container");
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>
